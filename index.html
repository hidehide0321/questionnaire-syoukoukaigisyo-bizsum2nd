<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>参加者情報フォーム</title>
  <style>
    /* 見やすい最小限のスタイル */
    :root { --bg:#f7f7f8; --panel:#fff; --text:#1f2328; --muted:#6e7781; --border:#e5e7eb;
            --primary:#2563eb; --success:#059669; --error:#dc2626; }
    body { margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Yu Gothic UI",Meiryo,sans-serif; line-height:1.6; }
    .container { max-width:720px; margin:40px auto; padding:24px; background:var(--panel);
      border:1px solid var(--border); border-radius:12px; }
    h1 { margin:0 0 12px; font-size:20px; }
    .desc { margin:0 0 20px; color:var(--muted); font-size:14px; }
    .field { margin-bottom:14px; }
    label { display:block; margin-bottom:6px; font-weight:600; font-size:14px; }
    input, textarea { width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:8px;
      font-size:14px; background:#fff; color:var(--text); box-sizing:border-box; }
    textarea { min-height:100px; resize:vertical; }
    button[type="submit"] { padding:10px 16px; background:var(--primary); color:#fff; border:none; border-radius:8px;
      font-size:14px; font-weight:600; cursor:pointer; }
    button[disabled] { opacity:.6; cursor:not-allowed; }
    .status { margin-top:10px; font-size:14px; }
    .status.success { color:var(--success); }
    .status.error { color:var(--error); }
    .hint { margin-top:4px; color:var(--muted); font-size:12px; }
  </style>
</head>
<body>
  <main class="container">
    <h1>参加者情報</h1>
    <p class="desc">必要事項をご入力のうえ、送信してください。</p>

    <form id="contactForm" novalidate>
      <!-- 必須項目 -->
      <div class="field">
        <label for="name">お名前</label>
        <input id="name" name="name" type="text" required placeholder="山田 太郎" />
      </div>
      <div class="field">
        <label for="furigana">フリガナ</label>
        <input id="furigana" name="furigana" type="text" required placeholder="ヤマダ タロウ" />
      </div>
      <div class="field">
        <label for="company">事業所名</label>
        <input id="company" name="company" type="text" required placeholder="〇〇株式会社 〇〇事業所" />
      </div>
      <div class="field">
        <label for="industry">業種</label>
        <input id="industry" name="industry" type="text" required placeholder="製造業 / 小売業 など" />
      </div>
      <div class="field">
        <label for="affiliation">所属団体など</label>
        <input id="affiliation" name="affiliation" type="text" required placeholder="商工会 / 業界団体 など" />
      </div>
      <div class="field">
        <label for="hometown">出身地</label>
        <input id="hometown" name="hometown" type="text" required placeholder="東京都〇〇市 など" />
      </div>
      <div class="field">
        <label for="tel">電話番号</label>
        <input id="tel" name="tel" type="tel" required placeholder="090-1234-5678" />
      </div>

      <!-- 名簿に記載しない任意項目（別シート保存） -->
      <div class="field">
        <label for="emergency">緊急連絡先（任意）</label>
        <input id="emergency" name="emergency" type="tel" placeholder="緊急時の連絡先（ご家族等）" />
        <div class="hint">（緊急の連絡先として事務局で管理いたします。参加者名簿には記載なし。）</div>
      </div>

      <!-- 活動自己PR（150文字）任意 -->
      <div class="field">
        <label for="pr">活動自己PR（150文字以内・任意）</label>
        <textarea id="pr" name="pr" maxlength="150" placeholder="活動の内容や自己PRをご記入ください。150文字以内"></textarea>
      </div>

      <button type="submit" id="submitBtn">送信</button>
      <div id="status" class="status" aria-live="polite"></div>
    </form>
  </main>

  <script>
    // 外部ホスティング: 提示いただいた GAS Web アプリ URL にPOST
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzLS9-e9uph5bI3feAzUdsOybkee8pj1p_nuBJszcwlu7svG3EZzfSsxguMb7Fv4fDADg/exec';
    const SUCCESS_MESSAGE = 'ご入力、送信しました！ありがとうございます。当日のご参加をお待ちしております。';

    const form = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const statusEl = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // HTML標準の required/type と reportValidity() を使用
      if (!form.reportValidity()) return;

      const originalLabel = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = '送信中';
      statusEl.textContent = '';
      statusEl.className = 'status';

      try {
        // application/x-www-form-urlencoded で送信
        const body = new URLSearchParams();
        body.append('name', form.name.value.trim());
        body.append('furigana', form.furigana.value.trim());
        body.append('company', form.company.value.trim());
        body.append('industry', form.industry.value.trim());
        body.append('affiliation', form.affiliation.value.trim());
        body.append('hometown', form.hometown.value.trim());
        body.append('tel', form.tel.value.trim());
        body.append('pr', form.pr.value.trim());                // 任意（maxlength=150）
        body.append('emergency', form.emergency.value.trim());  // 任意（別シート保存）

        const res = await fetch(WEB_APP_URL, { method: 'POST', body });
        if (!res.ok) throw new Error('ネットワークエラー (' + res.status + ')');

        const data = await res.json();
        if (data.status === 'success') {
          statusEl.textContent = SUCCESS_MESSAGE;
          statusEl.classList.add('success');
          form.reset();
        } else {
          throw new Error(data.message || '送信に失敗しました。');
        }
      } catch (err) {
        statusEl.textContent = 'エラー: ' + (err && err.message ? err.message : String(err));
        statusEl.classList.add('error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalLabel;
      }
    });
  </script>
</body>
</html>
